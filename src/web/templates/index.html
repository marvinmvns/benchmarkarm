<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Voice Processor - Configura√ß√£o</title>
    <link rel="stylesheet" href="/static/css/style.css">
</head>

<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <h1>üéôÔ∏è Voice Processor</h1>
            <div class="status-bar">
                <span id="status-indicator" class="status-dot"></span>
                <span id="status-text">Carregando...</span>
            </div>
        </header>

        <!-- Navigation -->
        <nav class="nav-tabs">
            <button class="tab-btn active" data-tab="general">Geral</button>
            <button class="tab-btn" data-tab="audio">√Åudio</button>
            <button class="tab-btn" data-tab="whisper">Whisper</button>
            <button class="tab-btn" data-tab="llm">LLM</button>
            <button class="tab-btn" data-tab="models">üì¶ Modelos</button>
            <button class="tab-btn" data-tab="offline">Offline</button>
            <button class="tab-btn" data-tab="power">Energia</button>
            <button class="tab-btn" data-tab="usb-receiver">üéß Escuta Cont√≠nua</button>
            <button class="tab-btn" data-tab="files">üìÇ Arquivos</button>
            <button class="tab-btn" data-tab="logs">üìã Logs</button>
            <button class="tab-btn" data-tab="system">Sistema</button>
            <button class="tab-btn" data-tab="transcription">üìù Transcri√ß√£o</button>
        </nav>

        <!-- Content -->
        <main class="content">
            <!-- General Tab -->
            <section id="tab-general" class="tab-content active">
                <h2>Configura√ß√µes Gerais</h2>

                <div class="form-group">
                    <label for="mode">Modo de Opera√ß√£o</label>
                    <select id="mode" name="mode">
                        <option value="local">Local (Offline)</option>
                        <option value="api">API (Online)</option>
                        <option value="hybrid">H√≠brido (Recomendado)</option>
                    </select>
                    <small>Local: tudo no dispositivo | API: usa servi√ßos externos | H√≠brido: melhor dos dois</small>
                </div>

                <!-- Feature Toggles Section -->
                <div class="status-card">
                    <h3>‚ö° Feature Toggles (Economizar Recursos)</h3>
                    <small style="color: var(--text-muted); margin-bottom: 12px; display: block;">
                        Desative recursos para economizar mem√≥ria no Raspberry Pi
                    </small>

                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="cache_enabled" name="system.cache_enabled">
                            üíæ Cache de Transcri√ß√µes
                        </label>
                        <small>Reduz processamento redundante (usa mem√≥ria)</small>
                    </div>

                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="memory_logs_enabled" name="system.memory_logs_enabled">
                            üìã Logs em Mem√≥ria
                        </label>
                        <small>Armazena logs para visualiza√ß√£o (usa ~2 MB RAM)</small>
                    </div>

                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="vad_enabled" name="audio.vad_enabled">
                            üéôÔ∏è Detec√ß√£o de Voz (VAD)
                        </label>
                        <small>Detecta automaticamente quando h√° fala</small>
                    </div>

                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="usb_auto_summarize" name="usb_receiver.auto_summarize">
                            ü§ñ Resumo Autom√°tico (LLM)
                        </label>
                        <small>Gera resumos das transcri√ß√µes (usa muita mem√≥ria/CPU)</small>
                    </div>

                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="low_memory_mode" name="system.low_memory_mode" checked>
                            üîã Modo Baixa Mem√≥ria
                        </label>
                        <small>Otimiza√ß√µes agressivas para Pi Zero 2W (512 MB RAM)</small>
                    </div>
                </div>
            </section>

            <!-- Audio Tab -->
            <section id="tab-audio" class="tab-content">
                <h2>Configura√ß√µes de √Åudio</h2>

                <div class="form-group">
                    <label for="sample_rate">Taxa de Amostragem</label>
                    <select id="sample_rate" name="audio.sample_rate">
                        <option value="8000">8000 Hz</option>
                        <option value="16000">16000 Hz (Recomendado)</option>
                        <option value="22050">22050 Hz</option>
                        <option value="44100">44100 Hz</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="max_duration">Dura√ß√£o M√°xima (segundos)</label>
                    <input type="number" id="max_duration" name="audio.max_duration" min="5" max="120" value="30">
                </div>

                <div class="form-group">
                    <label for="silence_duration">Sil√™ncio para Parar (segundos)</label>
                    <input type="number" id="silence_duration" name="audio.silence_duration" min="0.5" max="10"
                        step="0.5" value="2.0">
                </div>

                <div class="form-group">
                    <label>
                        <input type="checkbox" id="vad_enabled" name="audio.vad.enabled" checked>
                        VAD (Detec√ß√£o de Voz)
                    </label>
                </div>

                <div class="form-group">
                    <label for="vad_aggressiveness">Agressividade VAD</label>
                    <input type="range" id="vad_aggressiveness" name="audio.vad.aggressiveness" min="0" max="3"
                        value="2">
                    <span id="vad_aggressiveness_value">2</span>
                    <small>0 = menos filtro, 3 = mais filtro de ru√≠do</small>
                </div>

                <div class="form-group">
                    <button type="button" id="btn-test-audio" class="btn btn-secondary">üîä Testar √Åudio</button>
                    <pre id="audio-test-result" class="result-box"></pre>
                </div>
            </section>

            <!-- Whisper Tab -->
            <section id="tab-whisper" class="tab-content">
                <h2>Configura√ß√µes do Whisper</h2>

                <div class="form-group">
                    <label for="whisper_model">Modelo</label>
                    <select id="whisper_model" name="whisper.model">
                        <option value="tiny">Tiny (75MB) - Mais r√°pido</option>
                        <option value="base">Base (142MB) - Equilibrado</option>
                        <option value="small">Small (466MB) - Mais preciso</option>
                    </select>
                    <small>Para Pi Zero 2W, use Tiny ou Base</small>
                </div>

                <div class="form-group">
                    <label for="whisper_language">Idioma</label>
                    <select id="whisper_language" name="whisper.language">
                        <option value="pt">Portugu√™s</option>
                        <option value="en">English</option>
                        <option value="es">Espa√±ol</option>
                        <option value="">Auto-detectar</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>
                        <input type="checkbox" id="whisper_use_cpp" name="whisper.use_cpp" checked>
                        Usar whisper.cpp (Mais r√°pido)
                    </label>
                </div>

                <div class="form-group">
                    <label for="whisper_threads">Threads</label>
                    <input type="number" id="whisper_threads" name="whisper.threads" min="1" max="8" value="4">
                </div>

                <div class="form-group">
                    <label for="whisper_beam_size">Beam Size</label>
                    <input type="number" id="whisper_beam_size" name="whisper.beam_size" min="1" max="5" value="1">
                    <small>1 = mais r√°pido (greedy), maior = mais preciso</small>
                </div>

                <div class="form-group">
                    <label>
                        <input type="checkbox" id="whisper_stream_mode" name="whisper.stream_mode">
                        üî¥ Modo Stream (Transcri√ß√£o em tempo real)
                    </label>
                    <small>Transcreve enquanto o √°udio √© capturado. Usa mais CPU.</small>
                </div>
            </section>

            <!-- LLM Tab -->
            <section id="tab-llm" class="tab-content">
                <h2>Configura√ß√µes do LLM</h2>

                <div class="form-group">
                    <label for="llm_provider">Provedor</label>
                    <select id="llm_provider" name="llm.provider">
                        <option value="local">Local (llama.cpp)</option>
                        <option value="openai">OpenAI</option>
                        <option value="anthropic">Anthropic</option>
                        <option value="ollama">Ollama</option>
                    </select>
                </div>

                <!-- Local LLM -->
                <div id="llm-local-config" class="config-section">
                    <h3>LLM Local</h3>
                    <div class="form-group">
                        <label for="local_model">Modelo</label>
                        <select id="local_model" name="llm.local.model">
                            <option value="tinyllama">TinyLlama (1.1B)</option>
                            <option value="phi2">Phi-2 (2.7B)</option>
                            <option value="gemma-2b">Gemma 2B</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="local_context_size">Contexto</label>
                        <input type="number" id="local_context_size" name="llm.local.context_size" min="128" max="2048"
                            value="512">
                    </div>
                    <div class="form-group">
                        <label for="local_max_tokens">Tokens M√°ximos</label>
                        <input type="number" id="local_max_tokens" name="llm.local.max_tokens" min="50" max="500"
                            value="150">
                    </div>
                </div>

                <!-- API Config -->
                <div id="llm-api-config" class="config-section" style="display:none;">
                    <h3>Configura√ß√£o API</h3>
                    <div class="form-group">
                        <label for="api_key">API Key</label>
                        <input type="password" id="api_key" placeholder="sk-...">
                        <small>‚ö†Ô∏è Nunca compartilhe sua API key</small>
                    </div>
                    <div class="form-group">
                        <label for="api_model">Modelo</label>
                        <input type="text" id="api_model" value="gpt-4o-mini">
                    </div>
                </div>

                <div class="form-group">
                    <label for="llm_temperature">Temperatura</label>
                    <input type="range" id="llm_temperature" name="llm.local.temperature" min="0" max="1" step="0.1"
                        value="0.3">
                    <span id="llm_temperature_value">0.3</span>
                    <small>0 = determin√≠stico, 1 = criativo</small>
                </div>
            </section>

            <!-- Models Tab -->
            <section id="tab-models" class="tab-content">
                <h2>üì¶ Gerenciador de Modelos</h2>

                <!-- Whisper Models -->
                <div class="config-section">
                    <h3>üéôÔ∏è Modelos Whisper (Transcri√ß√£o)</h3>
                    <p class="section-description">Modelos para transcri√ß√£o de √°udio. Modelos menores s√£o mais r√°pidos
                        mas menos precisos.</p>

                    <div id="whisper-models" class="models-grid">
                        <div class="model-card" data-model="tiny">
                            <div class="model-header">
                                <span class="model-name">tiny</span>
                                <span class="model-size">~75 MB</span>
                            </div>
                            <p class="model-desc">Mais r√°pido, menos preciso. Ideal para Pi Zero.</p>
                            <div class="model-actions">
                                <span class="model-status" id="whisper-tiny-status">‚ùì</span>
                                <button class="btn btn-small" onclick="downloadWhisperModel('tiny')">üì• Baixar</button>
                            </div>
                        </div>

                        <div class="model-card" data-model="base">
                            <div class="model-header">
                                <span class="model-name">base</span>
                                <span class="model-size">~142 MB</span>
                            </div>
                            <p class="model-desc">Bom equil√≠brio velocidade/precis√£o.</p>
                            <div class="model-actions">
                                <span class="model-status" id="whisper-base-status">‚ùì</span>
                                <button class="btn btn-small" onclick="downloadWhisperModel('base')">üì• Baixar</button>
                            </div>
                        </div>

                        <div class="model-card" data-model="small">
                            <div class="model-header">
                                <span class="model-name">small</span>
                                <span class="model-size">~466 MB</span>
                            </div>
                            <p class="model-desc">Mais preciso, mais lento.</p>
                            <div class="model-actions">
                                <span class="model-status" id="whisper-small-status">‚ùì</span>
                                <button class="btn btn-small" onclick="downloadWhisperModel('small')">üì• Baixar</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- LLM Models -->
                <div class="config-section">
                    <h3>ü§ñ Modelos LLM (Resumo/Chat)</h3>
                    <p class="section-description">Modelos de linguagem para gerar resumos. Precisam de mais RAM/swap.
                    </p>

                    <div id="llm-models" class="models-grid">
                        <div class="model-card" data-model="tinyllama">
                            <div class="model-header">
                                <span class="model-name">TinyLlama 1.1B</span>
                                <span class="model-size">~670 MB</span>
                            </div>
                            <p class="model-desc">Modelo pequeno, funciona no Pi Zero com swap.</p>
                            <div class="model-actions">
                                <span class="model-status" id="llm-tinyllama-status">‚ùì</span>
                                <button class="btn btn-small" onclick="downloadLLMModel('tinyllama')">üì• Baixar</button>
                            </div>
                        </div>

                        <div class="model-card" data-model="phi2">
                            <div class="model-header">
                                <span class="model-name">Phi-2 2.7B</span>
                                <span class="model-size">~1.6 GB</span>
                            </div>
                            <p class="model-desc">Mais capaz, requer mais recursos.</p>
                            <div class="model-actions">
                                <span class="model-status" id="llm-phi2-status">‚ùì</span>
                                <button class="btn btn-small" onclick="downloadLLMModel('phi2')">üì• Baixar</button>
                            </div>
                        </div>

                        <div class="model-card" data-model="gemma2b">
                            <div class="model-header">
                                <span class="model-name">Gemma 2B</span>
                                <span class="model-size">~1.5 GB</span>
                            </div>
                            <p class="model-desc">Google Gemma, boa qualidade.</p>
                            <div class="model-actions">
                                <span class="model-status" id="llm-gemma2b-status">‚ùì</span>
                                <button class="btn btn-small" onclick="downloadLLMModel('gemma2b')">üì• Baixar</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Download Progress -->
                <div id="download-progress" class="status-card" style="display: none;">
                    <h3>‚è≥ Download em Progresso</h3>
                    <div class="progress-bar">
                        <div class="progress-fill" id="download-progress-fill" style="width: 0%"></div>
                    </div>
                    <p id="download-progress-text">Iniciando...</p>
                </div>

                <!-- Refresh Button -->
                <div style="margin-top: 16px;">
                    <button class="btn btn-secondary" onclick="refreshModelStatus()">üîÑ Atualizar Status</button>
                </div>
            </section>

            <!-- Offline Queue Tab -->
            <section id="tab-offline" class="tab-content">
                <h2>Fila Offline</h2>

                <div class="form-group">
                    <label>
                        <input type="checkbox" id="offline_enabled" name="offline_queue.enabled" checked>
                        Habilitar Fila Offline
                    </label>
                    <small>Armazena tarefas quando sem internet</small>
                </div>

                <div class="form-group">
                    <label for="max_queue_size">Tamanho M√°ximo da Fila</label>
                    <input type="number" id="max_queue_size" name="offline_queue.max_queue_size" min="100" max="10000"
                        value="1000">
                </div>

                <div class="form-group">
                    <label for="retry_delay">Delay Base para Retry (s)</label>
                    <input type="number" id="retry_delay" name="offline_queue.retry_delay_base" min="10" max="300"
                        value="30">
                </div>

                <div class="form-group">
                    <label for="max_retries">M√°ximo de Retries</label>
                    <input type="number" id="max_retries" name="offline_queue.max_retries" min="1" max="10" value="3">
                </div>

                <div class="form-group">
                    <label>
                        <input type="checkbox" id="use_local_fallback" name="offline_queue.use_local_fallback" checked>
                        Usar LLM Local como Fallback
                    </label>
                </div>

                <div class="status-card">
                    <h3>Status da Fila</h3>
                    <div id="queue-stats">
                        <p>Pendentes: <span id="queue-pending">-</span></p>
                        <p>Processando: <span id="queue-processing">-</span></p>
                        <p>Conclu√≠dos: <span id="queue-completed">-</span></p>
                        <p>Conectividade: <span id="queue-online">-</span></p>
                    </div>
                    <button type="button" id="btn-refresh-queue" class="btn btn-secondary">üîÑ Atualizar</button>
                </div>
            </section>

            <!-- Power Management Tab -->
            <section id="tab-power" class="tab-content">
                <h2>Gerenciamento de Energia</h2>

                <div class="form-group">
                    <label>
                        <input type="checkbox" id="power_enabled" name="power_management.enabled">
                        <strong>Habilitar Gerenciamento de Energia</strong>
                    </label>
                    <small>Feature toggle - controla consumo de energia</small>
                </div>

                <div class="form-group">
                    <label for="power_mode">Modo Padr√£o</label>
                    <select id="power_mode" name="power_management.default_mode">
                        <option value="performance">Performance (~1800mW)</option>
                        <option value="balanced">Equilibrado (~1200mW)</option>
                        <option value="power_save">Economia (~800mW)</option>
                        <option value="ultra_power_save">Ultra Economia (~500mW)</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>
                        <input type="checkbox" id="power_auto_adjust" name="power_management.auto_adjust" checked>
                        Ajuste Autom√°tico
                    </label>
                    <small>Ajusta baseado em atividade e temperatura</small>
                </div>

                <div class="form-group">
                    <label for="idle_timeout">Timeout para Idle (s)</label>
                    <input type="number" id="idle_timeout" name="power_management.idle_timeout" min="30" max="600"
                        value="60">
                </div>

                <div class="form-group">
                    <label for="temp_high">Temperatura Alta (¬∞C)</label>
                    <input type="number" id="temp_high" name="power_management.thermal.threshold_high" min="50" max="80"
                        value="70">
                </div>

                <div class="form-group">
                    <label for="temp_critical">Temperatura Cr√≠tica (¬∞C)</label>
                    <input type="number" id="temp_critical" name="power_management.thermal.threshold_critical" min="60"
                        max="90" value="80">
                </div>

                <div class="status-card">
                    <h3>Status de Energia</h3>
                    <div id="power-stats">
                        <p>Modo Atual: <span id="power-current-mode">-</span></p>
                        <p>Temperatura: <span id="power-temp">-</span></p>
                        <p>Idle: <span id="power-idle">-</span></p>
                    </div>
                </div>
            </section>

            <!-- USB Receiver Tab -->
            <section id="tab-usb-receiver" class="tab-content">
                <h2>üéß Escuta Cont√≠nua & Transcri√ß√£o</h2>

                <div class="info-box">
                    <p>üí° <strong>O Raspberry Pi pode escutar e transcrever √°udio automaticamente de duas
                            formas:</strong></p>
                    <p>1. <strong>ReSpeaker HAT</strong> - Usa o microfone local para capturar √°udio</p>
                    <p>2. <strong>USB Gadget</strong> - Recebe √°udio de um PC conectado via USB</p>
                </div>

                <!-- Modo 1: ReSpeaker (Microfone Local) -->
                <div class="config-section">
                    <h3>üéôÔ∏è Modo 1: ReSpeaker HAT (Microfone Local)</h3>

                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="usb_receiver_enabled" name="usb_receiver.enabled" checked>
                            <strong>Habilitar Escuta via ReSpeaker</strong>
                        </label>
                        <small>Usa o microfone do ReSpeaker HAT para capturar √°udio ambiente</small>
                    </div>

                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="usb_continuous_listen" name="usb_receiver.continuous_listen"
                                checked>
                            <strong>Escuta Cont√≠nua Autom√°tica</strong>
                        </label>
                        <small>Quando habilitado, escuta e transcreve 24/7 automaticamente</small>
                    </div>

                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="usb_auto_start" name="usb_receiver.auto_start">
                            <strong>üöÄ Auto-Iniciar ao Abrir</strong>
                        </label>
                        <small>Inicia a escuta automaticamente quando a aplica√ß√£o √© aberta</small>
                    </div>

                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="usb_auto_process" name="usb_receiver.auto_process">
                            <strong>üîÑ Auto-Processar Arquivos</strong>
                        </label>
                        <small>Inicia o processamento em lote automaticamente (transcreve .wav ‚Üí .txt, remove
                            .wav)</small>
                    </div>
                </div>

                <!-- Modo 2: USB Gadget -->
                <div class="config-section">
                    <h3>üîå Modo 2: USB Gadget (√Åudio via USB)</h3>

                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="usb_gadget_enabled" name="usb_receiver.usb_gadget_enabled">
                            <strong>Habilitar USB Gadget</strong>
                        </label>
                        <small>‚ö†Ô∏è Transforma o Pi em placa de som USB. Requer:
                            <code>sudo ./scripts/setup_usb_gadget.sh</code></small>
                    </div>
                </div>

                <!-- Controles de Escuta -->
                <div class="status-card">
                    <h3>üéõÔ∏è Controles de Escuta</h3>

                    <div class="listener-controls">
                        <button type="button" id="btn-listener-start" class="btn btn-primary">
                            ‚ñ∂Ô∏è Iniciar Escuta
                        </button>
                        <button type="button" id="btn-listener-pause" class="btn btn-secondary" disabled>
                            ‚è∏Ô∏è Pausar
                        </button>
                        <button type="button" id="btn-listener-stop" class="btn btn-danger" disabled>
                            ‚èπÔ∏è Parar
                        </button>
                    </div>

                    <div id="listener-status" class="listener-status">
                        <p>Estado: <span id="listener-state" class="status-badge">Parado</span></p>
                        <p>Segmentos transcritos: <span id="listener-segments-count">0</span></p>
                    </div>
                </div>
                <!-- Transcri√ß√µes em Tempo Real -->
                <div class="status-card transcriptions-panel">
                    <div class="panel-header">
                        <h3>üìù Transcri√ß√µes em Tempo Real</h3>
                        <div class="panel-actions">
                            <button type="button" id="btn-export-json" class="btn btn-small" title="Exportar JSON">
                                üì• JSON
                            </button>
                            <button type="button" id="btn-export-txt" class="btn btn-small" title="Exportar TXT">
                                üìÑ TXT
                            </button>
                            <button type="button" id="btn-clear-segments" class="btn btn-small btn-danger"
                                title="Limpar">
                                üóëÔ∏è
                            </button>
                        </div>
                    </div>

                    <!-- Filtros e Busca -->
                    <div class="transcription-filters">
                        <div class="search-box">
                            <input type="text" id="transcription-search" placeholder="üîç Buscar nas transcri√ß√µes...">
                        </div>
                        <div class="filter-options">
                            <label class="filter-item">
                                <input type="checkbox" id="filter-with-summary" checked>
                                Com resumo
                            </label>
                            <select id="filter-duration">
                                <option value="">Todas dura√ß√µes</option>
                                <option value="short">Curtas (&lt; 10s)</option>
                                <option value="medium">M√©dias (10-60s)</option>
                                <option value="long">Longas (&gt; 60s)</option>
                            </select>
                        </div>
                    </div>

                    <!-- Lista de Transcri√ß√µes -->
                    <div id="live-transcriptions" class="live-transcriptions">
                        <p class="empty-message">Nenhuma transcri√ß√£o ainda. Inicie a escuta para ver as transcri√ß√µes
                            em
                            tempo real.</p>
                    </div>

                    <!-- Controles Inferiores -->
                    <div class="transcription-footer">
                        <span id="transcription-count">0 transcri√ß√µes</span>
                        <button type="button" id="btn-refresh-transcriptions" class="btn btn-secondary">
                            üîÑ Atualizar
                        </button>
                        <button type="button" id="btn-load-more" class="btn btn-secondary" disabled>
                            üìú Carregar mais
                        </button>
                    </div>
                </div>

                <div id="usb-receiver-config" class="config-section">
                    <h3>Configura√ß√µes de Grava√ß√£o</h3>

                    <div class="form-group">
                        <label for="usb_save_directory">Diret√≥rio de Grava√ß√µes</label>
                        <input type="text" id="usb_save_directory" name="usb_receiver.save_directory"
                            value="~/audio-recordings">
                        <small>Onde os arquivos de √°udio ser√£o salvos</small>
                    </div>

                    <div class="form-group">
                        <label for="usb_sample_rate">Taxa de Amostragem</label>
                        <select id="usb_sample_rate" name="usb_receiver.sample_rate">
                            <option value="44100">44100 Hz (CD Quality)</option>
                            <option value="48000">48000 Hz (DVD Quality)</option>
                            <option value="16000">16000 Hz (Otimizado Whisper)</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="usb_channels">Canais</label>
                        <select id="usb_channels" name="usb_receiver.channels">
                            <option value="2">Stereo (2 canais)</option>
                            <option value="1">Mono (1 canal)</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="usb_max_duration">Dura√ß√£o M√°xima por Arquivo (segundos)</label>
                        <input type="number" id="usb_max_duration" name="usb_receiver.max_audio_duration" min="60"
                            max="3600" value="300">
                        <small>Arquivos ser√£o divididos ap√≥s este tempo</small>
                    </div>

                    <h3>Processamento Autom√°tico</h3>

                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="usb_auto_transcribe" name="usb_receiver.auto_transcribe" checked>
                            Transcrever automaticamente com Whisper
                        </label>
                    </div>

                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="usb_auto_summarize" name="usb_receiver.auto_summarize" checked>
                            Gerar resumo autom√°tico com LLM
                        </label>
                    </div>

                    <div class="form-group">
                        <label for="usb_min_duration">Dura√ß√£o M√≠nima para Processar (segundos)</label>
                        <input type="number" id="usb_min_duration" name="usb_receiver.min_audio_duration" min="1"
                            max="60" step="0.5" value="3">
                        <small>√Åudios menores ser√£o ignorados</small>
                    </div>

                    <h3>Divis√£o por Sil√™ncio</h3>

                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="usb_silence_split" name="usb_receiver.silence_split" checked>
                            Dividir grava√ß√£o quando detectar sil√™ncio
                        </label>
                    </div>

                    <div class="form-group">
                        <label for="usb_silence_threshold">Tempo de Sil√™ncio para Dividir (segundos)</label>
                        <input type="number" id="usb_silence_threshold" name="usb_receiver.silence_threshold" min="0.5"
                            max="10" step="0.5" value="2">
                    </div>

                    <h3>Op√ß√µes Adicionais</h3>

                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="usb_process_on_disconnect"
                                name="usb_receiver.process_on_disconnect" checked>
                            Processar quando USB desconectar
                        </label>
                    </div>

                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="usb_keep_original" name="usb_receiver.keep_original_audio"
                                checked>
                            Manter arquivo de √°udio original ap√≥s processar
                        </label>
                    </div>
                </div>

                <div class="status-card">
                    <h3>Status do USB Gadget</h3>
                    <div id="usb-gadget-status">
                        <p>Estado: <span id="usb-gadget-state">N√£o configurado</span></p>
                        <p>M√≥dulo g_audio: <span id="usb-module-status">-</span></p>
                        <p>Grava√ß√µes Salvas: <span id="usb-recordings-count">0</span></p>
                    </div>
                    <button type="button" id="btn-check-usb-status" class="btn btn-secondary">üîÑ Verificar
                        Status</button>
                </div>
            </section>

            <!-- System Tab -->
            <section id="tab-system" class="tab-content">
                <h2>Sistema</h2>

                <div class="status-card">
                    <h3>Informa√ß√µes do Sistema</h3>
                    <div id="system-info">
                        <p>Plataforma: <span id="sys-platform">-</span></p>
                        <p>Hostname: <span id="sys-hostname">-</span></p>
                        <p>CPU Temp: <span id="sys-temp">-</span></p>
                        <p>Mem√≥ria: <span id="sys-memory">-</span></p>
                        <p>Disco: <span id="sys-disk">-</span></p>
                    </div>
                    <button type="button" id="btn-refresh-system" class="btn btn-secondary">üîÑ Atualizar</button>
                </div>

                <div class="form-group">
                    <label for="log_level">N√≠vel de Log</label>
                    <select id="log_level" name="system.log_level">
                        <option value="DEBUG">Debug</option>
                        <option value="INFO">Info</option>
                        <option value="WARNING">Warning</option>
                        <option value="ERROR">Error</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="timeout">Timeout de Processamento (s)</label>
                    <input type="number" id="timeout" name="system.timeout" min="30" max="300" value="60">
                </div>

                <div class="form-group">
                    <h3>A√ß√µes</h3>
                    <button type="button" id="btn-export" class="btn btn-secondary">üì§ Exportar Config</button>
                    <button type="button" id="btn-import" class="btn btn-secondary">üì• Importar Config</button>
                    <button type="button" id="btn-reset" class="btn btn-danger">üîÑ Resetar Padr√µes</button>
                </div>
            </section>

            <!-- Transcription Tab -->
            <section id="tab-transcription" class="tab-content">
                <h2>üìù Transcri√ß√£o de Voz</h2>

                <!-- Controles de Grava√ß√£o -->
                <div class="transcription-controls">
                    <button type="button" id="btn-record" class="btn btn-record">
                        <span class="record-icon">üéôÔ∏è</span>
                        <span id="record-btn-text">Iniciar Grava√ß√£o</span>
                    </button>
                    <div id="recording-status" class="recording-status hidden">
                        <span class="pulse-dot"></span>
                        <span id="recording-status-text">Gravando...</span>
                    </div>
                </div>

                <!-- Resultado da Transcri√ß√£o Atual -->
                <div id="current-transcription" class="transcription-result hidden">
                    <h3>√öltima Transcri√ß√£o</h3>
                    <div class="transcription-text-container">
                        <div class="transcription-meta">
                            <span id="trans-timestamp"></span>
                            <span id="trans-duration"></span>
                            <span id="trans-time"></span>
                        </div>
                        <div id="transcription-text" class="transcription-text"></div>
                    </div>
                    <div id="transcription-summary" class="transcription-summary hidden">
                        <h4>üìã Resumo</h4>
                        <p id="summary-text"></p>
                    </div>
                </div>

                <!-- Upload de √Åudio -->
                <div class="upload-section">
                    <h3>Ou envie um arquivo de √°udio</h3>
                    <div class="upload-area">
                        <input type="file" id="audio-upload" accept="audio/*,.wav,.mp3,.ogg,.m4a" hidden>
                        <button type="button" id="btn-upload" class="btn btn-secondary">
                            üì§ Enviar Arquivo de √Åudio
                        </button>
                        <span id="upload-filename"></span>
                    </div>
                </div>

                <!-- Hist√≥rico -->
                <div class="history-section">
                    <div class="history-header">
                        <h3>üìú Hist√≥rico</h3>
                        <button type="button" id="btn-clear-history" class="btn btn-secondary btn-small">
                            üóëÔ∏è Limpar
                        </button>
                    </div>
                    <div id="transcription-history" class="transcription-history">
                        <p class="empty-history">Nenhuma transcri√ß√£o ainda.</p>
                    </div>
                </div>

                <!-- Status do Processador -->
                <div class="status-card">
                    <h3>Status do Processador</h3>
                    <div id="processor-status">
                        <p>Modo: <span id="proc-mode">-</span></p>
                        <p>Modelo Whisper: <span id="proc-whisper">-</span></p>
                        <p>LLM: <span id="proc-llm">-</span></p>
                        <p>Total Transcri√ß√µes: <span id="proc-total">0</span></p>
                    </div>
                </div>
            </section>

            <!-- Files Tab -->
            <section id="tab-files" class="tab-content">
                <h2>üìÇ Arquivos de Transcri√ß√£o</h2>

                <!-- Batch Processor Status -->
                <div class="status-card">
                    <h3>üîÑ Processador em Lote</h3>
                    <div id="batch-status">
                        <p>Estado: <span id="batch-state" class="status-badge">Parado</span></p>
                        <p>Arquivos pendentes (.wav): <span id="batch-pending">0</span></p>
                        <p>Processados: <span id="batch-processed">0</span></p>
                        <p>Falhas: <span id="batch-failed">0</span></p>
                        <p>√öltima execu√ß√£o: <span id="batch-last-run">-</span></p>
                        <p>Pr√≥xima execu√ß√£o: <span id="batch-next-run">-</span></p>
                    </div>
                    <div class="batch-controls">
                        <button type="button" id="btn-batch-run" class="btn btn-primary">‚ñ∂Ô∏è Processar Agora</button>
                        <button type="button" id="btn-batch-start" class="btn btn-secondary">üîÑ Iniciar
                            Autom√°tico</button>
                        <button type="button" id="btn-batch-stop" class="btn btn-secondary" disabled>‚èπÔ∏è Parar
                            Autom√°tico</button>
                    </div>
                </div>

                <!-- Info Box -->
                <div class="info-box">
                    <p>üí° <strong>Como funciona:</strong></p>
                    <p>1. Arquivos <code>.wav</code> s√£o gravados em <code>~/audio-recordings</code></p>
                    <p>2. O processador transcreve com Whisper e salva como <code>.txt</code></p>
                    <p>3. Ap√≥s sucesso, o arquivo <code>.wav</code> √© removido para economizar espa√ßo</p>
                </div>

                <!-- Search -->
                <div class="files-search">
                    <input type="text" id="files-search-input" placeholder="üîç Buscar nas transcri√ß√µes...">
                    <button type="button" id="btn-files-search" class="btn btn-secondary">Buscar</button>
                    <button type="button" id="btn-files-refresh" class="btn btn-secondary">üîÑ Atualizar Lista</button>
                </div>

                <!-- Files List -->
                <div class="files-list-container">
                    <h3>üìÑ Transcri√ß√µes Salvas</h3>
                    <div id="files-list" class="files-list">
                        <p class="empty-message">Carregando...</p>
                    </div>
                    <div class="files-footer">
                        <span id="files-count">0 arquivos</span>
                    </div>
                </div>

                <!-- Search Results -->
                <div id="search-results" class="search-results" style="display: none;">
                    <h3>üîç Resultados da Busca</h3>
                    <div id="search-results-list"></div>
                    <button type="button" id="btn-clear-search" class="btn btn-secondary">Limpar Busca</button>
                </div>
            </section>

            <!-- File View Modal -->
            <div id="file-view-modal" class="modal" style="display: none;">
                <div class="modal-content modal-large">
                    <div class="modal-header">
                        <h3 id="modal-filename">Arquivo</h3>
                        <button type="button" class="modal-close" onclick="closeFileModal()">&times;</button>
                    </div>
                    <div class="modal-body">
                        <pre id="modal-file-content" class="file-content"></pre>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" onclick="closeFileModal()">Fechar</button>
                        <button type="button" id="btn-modal-delete" class="btn btn-danger">üóëÔ∏è Deletar</button>
                    </div>
                </div>
            </div>

            <!-- Logs Tab -->
            <section id="tab-logs" class="tab-content">
                <h2>üìã Logs da Aplica√ß√£o</h2>

                <!-- Stats -->
                <div class="status-card">
                    <h3>üìä Estat√≠sticas</h3>
                    <div class="logs-stats">
                        <span class="stat-item">
                            <span class="stat-label">Total:</span>
                            <span id="logs-total" class="stat-value">0</span>
                        </span>
                        <span class="stat-item">
                            <span class="stat-label">Erros:</span>
                            <span id="logs-errors" class="stat-value error">0</span>
                        </span>
                        <span class="stat-item">
                            <span class="stat-label">Avisos:</span>
                            <span id="logs-warnings" class="stat-value warning">0</span>
                        </span>
                    </div>
                </div>

                <!-- Controls -->
                <div class="logs-controls">
                    <div class="logs-filters">
                        <select id="logs-level-filter">
                            <option value="">Todos os n√≠veis</option>
                            <option value="DEBUG">DEBUG</option>
                            <option value="INFO">INFO</option>
                            <option value="WARNING">WARNING</option>
                            <option value="ERROR">ERROR</option>
                            <option value="CRITICAL">CRITICAL</option>
                        </select>
                        <input type="number" id="logs-limit" value="100" min="10" max="500" placeholder="Limite">
                    </div>
                    <div class="logs-actions">
                        <button class="btn btn-small" id="btn-refresh-logs">üîÑ Atualizar</button>
                        <button class="btn btn-small" id="btn-errors-only">‚ùå S√≥ Erros</button>
                        <button class="btn btn-small btn-danger" id="btn-clear-logs">üóëÔ∏è Limpar</button>
                    </div>
                </div>

                <!-- Info Box -->
                <div class="info-box">
                    <p>üí° Os logs s√£o armazenados em mem√≥ria (√∫ltimos 500 registros). Use os filtros para encontrar
                        erros ou informa√ß√µes espec√≠ficas.</p>
                </div>

                <!-- Logs List -->
                <div class="logs-container">
                    <div id="logs-list" class="logs-list">
                        <p class="empty-message">Carregando logs...</p>
                    </div>
                </div>

                <!-- Auto-refresh toggle -->
                <div class="logs-footer">
                    <label class="toggle-label">
                        <input type="checkbox" id="logs-auto-refresh">
                        Auto-atualizar (5s)
                    </label>
                    <span id="logs-last-update">-</span>
                </div>
            </section>

        </main>

        <!-- Footer Actions -->
        <footer class="footer">
            <button type="button" id="btn-save" class="btn btn-primary">üíæ Salvar Configura√ß√µes</button>
            <button type="button" id="btn-save-restart" class="btn btn-warning">üíæüîÑ Salvar e Reiniciar</button>
            <button type="button" id="btn-reload" class="btn btn-secondary">‚Ü©Ô∏è Recarregar</button>
            <span id="save-status"></span>
        </footer>
    </div>

    <script src="/static/js/app.js"></script>
</body>

</html>