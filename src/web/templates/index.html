<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Voice Processor - Configura√ß√£o</title>
    <link rel="stylesheet" href="/static/css/style.css">
</head>

<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <h1>üéôÔ∏è Voice Processor</h1>
            <div class="status-bar">
                <span id="status-indicator" class="status-dot"></span>
                <span id="status-text">Carregando...</span>
            </div>
        </header>

        <!-- Navigation -->
        <nav class="nav-tabs">
            <button class="tab-btn active" data-tab="general">Geral</button>
            <button class="tab-btn" data-tab="audio">√Åudio</button>
            <button class="tab-btn" data-tab="whisper">Whisper</button>
            <button class="tab-btn" data-tab="llm">LLM</button>

            <button class="tab-btn" data-tab="offline">Offline</button>
            <button class="tab-btn" data-tab="usb-receiver">üéß Escuta Cont√≠nua</button>
            <button class="tab-btn" data-tab="files">üìÇ Arquivos</button>
            <button class="tab-btn" data-tab="history">üìö Hist√≥rico</button>
            <button class="tab-btn" data-tab="logs">üìã Logs</button>
            <button class="tab-btn" data-tab="system">Sistema</button>
            <button class="tab-btn" data-tab="transcription">üìù Transcri√ß√£o</button>
        </nav>

        <!-- Content -->
        <main class="content">
            <!-- General Tab -->
            <section id="tab-general" class="tab-content active">
                <h2>Configura√ß√µes Gerais</h2>

                <!-- Sistema usa as configura√ß√µes de Whisper/LLM diretamente.
                     Fallback autom√°tico para local quando offline. -->

                <!-- Auto-Start Section -->
                <div class="status-card">
                    <h3>üöÄ Inicializa√ß√£o do Sistema</h3>
                    <div class="form-group">
                        <label class="toggle-label">
                            <input type="checkbox" id="autostart_enabled" onchange="toggleAutoStart(this.checked)">
                            <span class="toggle-text">Iniciar automaticamente no boot</span>
                        </label>
                        <small>Quando ativado, o servi√ßo inicia automaticamente ao ligar o Raspberry Pi</small>
                    </div>
                    <div id="autostart-status" class="status-text" style="margin-top: 8px; font-size: 0.85rem;"></div>
                </div>

                <!-- Feature Toggles Section -->
                <div class="status-card">
                    <h3>‚ö° Feature Toggles (Economizar Recursos)</h3>
                    <small style="color: var(--text-muted); margin-bottom: 12px; display: block;">
                        Desative recursos para economizar mem√≥ria no Raspberry Pi
                    </small>

                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="cache_enabled" name="system.cache_enabled">
                            üíæ Cache de Transcri√ß√µes
                        </label>
                        <small>Reduz processamento redundante (usa mem√≥ria)</small>
                    </div>

                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="memory_logs_enabled" name="system.memory_logs_enabled">
                            üìã Logs em Mem√≥ria
                        </label>
                        <small>Armazena logs para visualiza√ß√£o (usa ~2 MB RAM)</small>
                    </div>

                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="vad_enabled" name="audio.vad_enabled">
                            üéôÔ∏è Detec√ß√£o de Voz (VAD)
                        </label>
                        <small>Detecta automaticamente quando h√° fala</small>
                    </div>

                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="usb_auto_summarize" name="usb_receiver.auto_summarize">
                            ü§ñ Resumo Autom√°tico (LLM)
                        </label>
                        <small>Gera resumos das transcri√ß√µes (usa muita mem√≥ria/CPU)</small>
                    </div>

                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="led_enabled" name="hardware.led_enabled" checked>
                            üí° LEDs do ReSpeaker
                        </label>
                        <small>Pisca LEDs durante captura/processamento de √°udio</small>
                    </div>

                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="low_memory_mode" name="system.low_memory_mode" checked>
                            üîã Modo Baixa Mem√≥ria
                        </label>
                        <small>Otimiza√ß√µes agressivas para Pi Zero 2W (512 MB RAM)</small>
                    </div>

                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="cpu_limit_enabled" name="system.cpu_limit_enabled" checked>
                            ‚ö° Limitador de CPU
                        </label>
                        <small>Pausa processamento quando CPU excede limite (evita congelamento)</small>
                    </div>

                    <div class="form-group">
                        <label for="cpu_limit_percent">Limite de CPU (%)</label>
                        <input type="range" id="cpu_limit_percent" name="system.cpu_limit_percent" min="50" max="95"
                            value="85" oninput="$('#cpu_limit_value').textContent=this.value">
                        <span id="cpu_limit_value">85</span>%
                        <small>50-95%. Menor = mais lento, menos chance de travar</small>
                    </div>

                    <hr style="margin: 20px 0; border-color: #333;">
                    <h3>üîã Economia de Energia</h3>

                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="power_enabled" name="power_management.enabled">
                            Habilitar Economia de Energia
                        </label>
                        <small>Reduz clock/consumo do Raspberry Pi para economizar energia</small>
                    </div>

                    <div class="form-group">
                        <label for="power_mode">Modo de Energia</label>
                        <select id="power_mode" name="power_management.default_mode" onchange="setPowerMode(this.value)">
                            <option value="performance">üöÄ Performance (m√°ximo desempenho)</option>
                            <option value="balanced">‚öñÔ∏è Balanceado (recomendado)</option>
                            <option value="power_save">üîã Economia (baixo consumo)</option>
                            <option value="ultra_power_save">üåô Ultra Economia (m√≠nimo consumo)</option>
                        </select>
                        <small>Ultra Economia: ~500mW | Performance: ~1800mW</small>
                    </div>

                    <div id="power_status_card" class="listener-status" style="margin-top: 12px;">
                        <span id="power_status_text">Status: Verificando...</span>
                    </div>

                    <hr style="margin: 20px 0; border-color: #333;">
                    <h3>üì° Fila Offline (Sem Internet)</h3>

                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="offline_queue_enabled" name="offline_queue.enabled" checked>
                            Habilitar Fila Offline
                        </label>
                        <small>Guarda √°udios quando sem internet para processar depois</small>
                    </div>

                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="offline_local_fallback" name="offline_queue.use_local_fallback" checked>
                            Fallback Local
                        </label>
                        <small>Usa whisper.cpp local se n√£o houver internet (mais lento)</small>
                    </div>

                    <div id="queue_status_card" class="listener-status" style="margin-top: 12px; display: flex; justify-content: space-between; align-items: center;">
                        <span id="queue_status_text">Status: Verificando...</span>
                        <button onclick="processOfflineQueue()" class="btn btn-small">Processar Fila</button>
                    </div>
                </div>
            </section>

            <!-- Audio Tab -->
            <section id="tab-audio" class="tab-content">
                <h2>Configura√ß√µes de √Åudio</h2>

                <div class="form-group">
                    <label for="sample_rate">Taxa de Amostragem</label>
                    <select id="sample_rate" name="audio.sample_rate">
                        <option value="8000">8000 Hz</option>
                        <option value="16000">16000 Hz (Recomendado)</option>
                        <option value="22050">22050 Hz</option>
                        <option value="44100">44100 Hz</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="max_duration">Dura√ß√£o M√°xima (segundos)</label>
                    <input type="number" id="max_duration" name="audio.max_duration" min="5" max="120" value="30">
                </div>

                <div class="form-group">
                    <label for="silence_duration">Sil√™ncio para Parar (segundos)</label>
                    <input type="number" id="silence_duration" name="audio.silence_duration" min="0.5" max="10"
                        step="0.5" value="2.0">
                </div>

                <div class="form-group">
                    <label>
                        <input type="checkbox" id="vad_enabled" name="audio.vad.enabled" checked>
                        VAD (Detec√ß√£o de Voz)
                    </label>
                </div>

                <div class="form-group">
                    <label for="vad_aggressiveness">Agressividade VAD</label>
                    <input type="range" id="vad_aggressiveness" name="audio.vad.aggressiveness" min="0" max="3"
                        value="2" oninput="$('#vad_aggressiveness_value').textContent=this.value">
                    <span id="vad_aggressiveness_value">2</span>
                    <small>0 = menos filtro, 3 = mais filtro de ru√≠do</small>
                </div>

                <hr>

                <h3>üß™ Testes de Hardware</h3>
                <div class="grid" style="grid-template-columns: 1fr 1fr; gap: 1rem;">
                    <div class="card bg-light">
                        <h4>Microfone</h4>
                        <p>Grava 3 segundos e reproduz aqui.</p>
                        <button class="btn btn-secondary" onclick="testMicrophone()" id="btn-test-mic">
                            üé§ Testar Grava√ß√£o
                        </button>
                        <div id="mic-test-result" style="margin-top: 10px;"></div>
                    </div>

                    <div class="card bg-light">
                        <h4>Falante</h4>
                        <p>Toca um tom no Raspberry Pi.</p>
                        <button class="btn btn-secondary" onclick="testSpeaker()" id="btn-test-speaker">
                            üîä Testar Som
                        </button>
                    </div>
                </div>
            </section>

            <!-- Whisper Tab -->
            <section id="tab-whisper" class="tab-content">
                <h2>Configura√ß√µes do Whisper</h2>

                <!-- Provider Selection -->
                <div class="form-group">
                    <label for="whisper_provider">Provedor</label>
                    <select id="whisper_provider" name="whisper.provider">
                        <option value="local">üñ•Ô∏è Local (whisper.cpp)</option>
                        <option value="whisperapi">üåê WhisperAPI (Servidor Externo)</option>
                        <option value="openai">‚òÅÔ∏è OpenAI API</option>
                    </select>
                    <small>Local: no dispositivo | WhisperAPI: servidor externo | OpenAI: nuvem</small>
                </div>

                <!-- Local Whisper Config -->
                <div id="whisper-local-config" class="config-section">
                    <h3>Configura√ß√£o Local</h3>

                    <div class="form-group">
                        <label for="whisper_model">Modelo</label>
                        <select id="whisper_model" name="whisper.model">
                            <option value="tiny">Tiny (75MB) - Mais r√°pido</option>
                            <option value="base">Base (142MB) - Equilibrado</option>
                            <option value="small">Small (466MB) - Mais preciso</option>
                        </select>
                        <small>Para Pi Zero 2W, use Tiny ou Base</small>
                    </div>

                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="whisper_use_cpp" name="whisper.use_cpp" checked>
                            Usar whisper.cpp (Mais r√°pido)
                        </label>
                    </div>

                    <div class="form-group">
                        <label for="whisper_threads">Threads</label>
                        <input type="number" id="whisper_threads" name="whisper.threads" min="1" max="8" value="4">
                    </div>

                    <div class="form-group">
                        <label for="whisper_beam_size">Beam Size</label>
                        <input type="number" id="whisper_beam_size" name="whisper.beam_size" min="1" max="5" value="1">
                        <small>1 = mais r√°pido (greedy), maior = mais preciso</small>
                    </div>

                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="whisper_stream_mode" name="whisper.stream_mode">
                            üî¥ Modo Stream (Transcri√ß√£o em tempo real)
                        </label>
                        <small>Transcreve enquanto o √°udio √© capturado. Usa mais CPU.</small>
                    </div>

                    <!-- Whisper Local Models -->
                    <div class="models-section">
                        <h4>üì• Modelos Dispon√≠veis</h4>
                        <p class="section-description">Modelos menores s√£o mais r√°pidos mas menos precisos.</p>

                        <div id="whisper-local-models" class="models-grid compact">
                            <div class="model-card" data-model="tiny">
                                <div class="model-header">
                                    <span class="model-name">tiny</span>
                                    <span class="model-size">~75 MB</span>
                                </div>
                                <p class="model-desc">Mais r√°pido, ideal para Pi Zero.</p>
                                <div class="model-actions">
                                    <span class="model-status" id="whisper-tiny-status">‚ùì</span>
                                    <button class="btn btn-small" onclick="downloadWhisperModel('tiny')">üì•</button>
                                </div>
                            </div>

                            <div class="model-card" data-model="base">
                                <div class="model-header">
                                    <span class="model-name">base</span>
                                    <span class="model-size">~142 MB</span>
                                </div>
                                <p class="model-desc">Bom equil√≠brio.</p>
                                <div class="model-actions">
                                    <span class="model-status" id="whisper-base-status">‚ùì</span>
                                    <button class="btn btn-small" onclick="downloadWhisperModel('base')">üì•</button>
                                </div>
                            </div>

                            <div class="model-card" data-model="small">
                                <div class="model-header">
                                    <span class="model-name">small</span>
                                    <span class="model-size">~466 MB</span>
                                </div>
                                <p class="model-desc">Mais preciso, mais lento.</p>
                                <div class="model-actions">
                                    <span class="model-status" id="whisper-small-status">‚ùì</span>
                                    <button class="btn btn-small" onclick="downloadWhisperModel('small')">üì•</button>
                                </div>
                            </div>
                        </div>

                        <button class="btn btn-secondary btn-small" onclick="refreshModelStatus()"
                            style="margin-top: 12px;">üîÑ Atualizar Status</button>
                    </div>
                </div>

                <!-- WhisperAPI Config -->
                <div id="whisper-whisperapi-config" class="config-section" style="display: none;">
                    <h3>üåê WhisperAPI (Servidor Externo)</h3>
                    <p class="info-box">Servidor de transcri√ß√£o externo. Ideal para offload de processamento.</p>

                    <div class="form-group">
                        <label for="whisperapi_url">üåê URL do Servidor</label>
                        <input type="text" id="whisperapi_url" name="whisper.whisperapi_url"
                            value="http://127.0.0.1:3001" placeholder="http://IP:PORTA">
                        <small>Ex: http://192.168.1.100:3001</small>
                    </div>

                    <div class="form-group">
                        <label for="whisperapi_urls">üîÑ Servidores Adicionais (Round Robin)</label>
                        <textarea id="whisperapi_urls" class="form-control" rows="3"
                            placeholder="http://192.168.1.102:3001&#10;http://192.168.1.103:3001"
                            style="width: 100%; border: 1px solid var(--border); border-radius: 6px; padding: 10px; background: var(--bg-card); color: var(--text);"></textarea>
                        <small>Adicione URLs extras para balanceamento de carga (uma por linha). O sistema ir√° alternar
                            entre a URL principal e estas URLs.</small>
                    </div>

                    <div class="form-group">
                        <label for="whisperapi_timeout">Timeout (segundos)</label>
                        <input type="number" id="whisperapi_timeout" name="whisper.whisperapi_timeout" min="30"
                            max="600" value="300">
                    </div>

                    <div class="form-group">
                        <button type="button" id="btn-test-whisperapi" class="btn btn-secondary">
                            üß™ Testar Conex√£o
                        </button>
                        <span id="whisperapi-test-result"></span>
                    </div>
                </div>

                <!-- OpenAI Whisper Config -->
                <div id="whisper-openai-config" class="config-section" style="display: none;">
                    <h3>‚òÅÔ∏è OpenAI Whisper API</h3>

                    <div class="form-group">
                        <label for="whisper_openai_api_key">API Key</label>
                        <input type="password" id="whisper_openai_api_key" name="whisper.openai_api_key"
                            placeholder="sk-..." autocomplete="off">
                        <small>Obtenha em <a href="https://platform.openai.com/api-keys"
                                target="_blank">platform.openai.com</a></small>
                    </div>

                    <div class="form-group">
                        <label for="whisper_openai_model">Modelo API</label>
                        <select id="whisper_openai_model" name="whisper.openai_model">
                            <option value="whisper-1">whisper-1 (Padr√£o)</option>
                        </select>
                    </div>
                </div>

                <!-- Common Settings -->
                <div class="form-group">
                    <label for="whisper_language">Idioma</label>
                    <select id="whisper_language" name="whisper.language">
                        <option value="pt">Portugu√™s</option>
                        <option value="en">English</option>
                        <option value="es">Espa√±ol</option>
                        <option value="">Auto-detectar</option>
                    </select>
                </div>

                <!-- Test Section -->
                <div class="config-section">
                    <h3>üß™ Teste de Transcri√ß√£o</h3>
                    <p class="info-box">Grava √°udio do microfone e transcreve usando o provider configurado. Fale algo
                        quando solicitado!</p>

                    <div class="form-group">
                        <label for="test_duration">Dura√ß√£o da Grava√ß√£o</label>
                        <select id="test_duration">
                            <option value="3">3 segundos</option>
                            <option value="5" selected>5 segundos</option>
                            <option value="10">10 segundos</option>
                            <option value="15">15 segundos</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <button type="button" id="btn-test-whisper" class="btn btn-primary btn-large">
                            üé§ Iniciar Teste de Transcri√ß√£o
                        </button>
                    </div>

                    <!-- Recording State Indicator -->
                    <div id="whisper-test-state" class="test-state-box" style="display:none;">
                        <div id="test-state-icon" class="state-icon">üé§</div>
                        <div id="test-state-message" class="state-message">Preparando...</div>
                        <div id="test-state-countdown" class="state-countdown"></div>
                    </div>

                    <!-- Result Box -->
                    <div id="whisper-test-result" class="test-result-box" style="display:none;">
                        <h4>‚úÖ Resultado:</h4>
                        <div id="whisper-test-text" class="transcription-text"></div>
                        <div id="whisper-test-timing" class="timing-info"></div>
                    </div>
                </div>
            </section>

            <!-- LLM Tab -->
            <section id="tab-llm" class="tab-content">
                <h2>Configura√ß√µes do LLM</h2>

                <div class="form-group">
                    <label for="llm_provider">Provedor</label>
                    <select id="llm_provider" name="llm.provider">
                        <option value="local">üñ•Ô∏è Local (llama.cpp)</option>
                        <option value="chatmock">ü§ñ ChatMock (GPT-5 Local)</option>
                        <option value="openai">‚òÅÔ∏è OpenAI</option>
                        <option value="anthropic">‚òÅÔ∏è Anthropic</option>
                        <option value="ollama">ü¶ô Ollama</option>
                    </select>
                </div>

                <!-- Local LLM -->
                <div id="llm-local-config" class="config-section">
                    <h3>LLM Local</h3>
                    <div class="form-group">
                        <label for="local_model">Modelo</label>
                        <select id="local_model" name="llm.local.model">
                            <option value="tinyllama">TinyLlama (1.1B)</option>
                            <option value="phi2">Phi-2 (2.7B)</option>
                            <option value="gemma-2b">Gemma 2B</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="local_context_size">Contexto</label>
                        <input type="number" id="local_context_size" name="llm.local.context_size" min="128" max="2048"
                            value="512">
                    </div>
                    <div class="form-group">
                        <label for="local_max_tokens">Tokens M√°ximos</label>
                        <input type="number" id="local_max_tokens" name="llm.local.max_tokens" min="50" max="500"
                            value="150">
                    </div>

                    <!-- LLM Local Models -->
                    <div class="models-section">
                        <h4>üì• Modelos Dispon√≠veis</h4>
                        <p class="section-description">Modelos de linguagem para resumos. Precisam de mais RAM/swap.</p>

                        <div id="llm-local-models" class="models-grid compact">
                            <div class="model-card" data-model="tinyllama">
                                <div class="model-header">
                                    <span class="model-name">TinyLlama 1.1B</span>
                                    <span class="model-size">~670 MB</span>
                                </div>
                                <p class="model-desc">Funciona no Pi Zero com swap.</p>
                                <div class="model-actions">
                                    <span class="model-status" id="llm-tinyllama-status">‚ùì</span>
                                    <button class="btn btn-small" onclick="downloadLLMModel('tinyllama')">üì•</button>
                                </div>
                            </div>

                            <div class="model-card" data-model="phi2">
                                <div class="model-header">
                                    <span class="model-name">Phi-2 2.7B</span>
                                    <span class="model-size">~1.6 GB</span>
                                </div>
                                <p class="model-desc">Mais capaz, requer mais recursos.</p>
                                <div class="model-actions">
                                    <span class="model-status" id="llm-phi2-status">‚ùì</span>
                                    <button class="btn btn-small" onclick="downloadLLMModel('phi2')">üì•</button>
                                </div>
                            </div>

                            <div class="model-card" data-model="gemma2b">
                                <div class="model-header">
                                    <span class="model-name">Gemma 2B</span>
                                    <span class="model-size">~1.5 GB</span>
                                </div>
                                <p class="model-desc">Google Gemma, boa qualidade.</p>
                                <div class="model-actions">
                                    <span class="model-status" id="llm-gemma2b-status">‚ùì</span>
                                    <button class="btn btn-small" onclick="downloadLLMModel('gemma2b')">üì•</button>
                                </div>
                            </div>
                        </div>

                        <button class="btn btn-secondary btn-small" onclick="refreshModelStatus()"
                            style="margin-top: 12px;">üîÑ Atualizar Status</button>
                    </div>
                </div>

                <!-- ChatMock Config -->
                <div id="llm-chatmock-config" class="config-section" style="display:none;">
                    <h3>ü§ñ ChatMock (API Compat√≠vel OpenAI)</h3>
                    <p class="info-box">Servidor local com API compat√≠vel OpenAI. Suporta GPT-5, GPT-5.1, GPT-5-Codex,
                        etc.</p>

                    <div class="form-group">
                        <label for="chatmock_base_url">üåê URL do Servidor</label>
                        <input type="text" id="chatmock_base_url" name="llm.chatmock.base_url"
                            value="http://127.0.0.1:8000/v1" placeholder="http://IP:PORTA/v1">
                        <small>Ex: http://192.168.1.100:8000/v1</small>
                    </div>

                    <div class="form-group">
                        <label for="chatmock_model">Modelo <a href="#"
                                onclick="fetchLLMModels('chatmock'); return false;"
                                style="font-size: 0.8em; color: #aaa;">üîÑ Listar</a></label>
                        <select id="chatmock_model" name="llm.chatmock.model">
                            <option value="gpt-5">gpt-5 (Padr√£o)</option>
                            <option value="gpt-5.1">gpt-5.1</option>
                            <option value="gpt-5.2">gpt-5.2</option>
                            <option value="gpt-5-codex">gpt-5-codex</option>
                            <option value="gpt-5.1-codex">gpt-5.1-codex</option>
                            <option value="gpt-5.1-codex-max">gpt-5.1-codex-max</option>
                            <option value="codex-mini">codex-mini</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="chatmock_reasoning">Esfor√ßo de Racioc√≠nio</label>
                        <select id="chatmock_reasoning" name="llm.chatmock.reasoning_effort">
                            <option value="minimal">Minimal</option>
                            <option value="low">Low</option>
                            <option value="medium" selected>Medium</option>
                            <option value="high">High</option>
                            <option value="xhigh">XHigh (5.1-codex-max e 5.2)</option>
                        </select>
                        <small>Maior esfor√ßo = respostas mais inteligentes, mas mais lentas</small>
                    </div>

                    <div class="form-group">
                        <label for="chatmock_max_tokens">Tokens M√°ximos</label>
                        <input type="number" id="chatmock_max_tokens" name="llm.chatmock.max_tokens" min="100"
                            max="4000" value="500">
                    </div>

                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="chatmock_web_search" name="llm.chatmock.enable_web_search">
                            üîç Habilitar Busca Web
                        </label>
                        <small>Permite que o modelo busque informa√ß√µes na internet</small>
                    </div>
                </div>

                <!-- API Config -->
                <div id="llm-api-config" class="config-section" style="display:none;">
                    <h3>Configura√ß√£o API</h3>
                    <div class="form-group">
                        <label for="api_key">API Key</label>
                        <input type="password" id="api_key" placeholder="sk-...">
                        <small>‚ö†Ô∏è Nunca compartilhe sua API key</small>
                    </div>
                    <div class="form-group">
                        <label for="api_model">Modelo <a href="#" onclick="fetchLLMModels('openai'); return false;"
                                style="font-size: 0.8em; color: #aaa;">üîÑ Listar</a></label>
                        <input type="text" id="api_model" value="gpt-4o-mini">
                    </div>
                </div>

                <div class="form-group">
                    <label for="llm_temperature">Temperatura</label>
                    <input type="range" id="llm_temperature" name="llm.local.temperature" min="0" max="1" step="0.1"
                        value="0.3">
                    <span id="llm_temperature_value">0.3</span>
                    <small>0 = determin√≠stico, 1 = criativo</small>
                </div>

                <div class="form-group" style="margin-top: 20px; border-top: 1px solid #444; padding-top: 15px;">
                    <h3>Teste de Conex√£o</h3>
                    <p class="force-small">Envia uma mensagem de teste ("Ol√°") para verificar a configura√ß√£o.</p>
                    <button type="button" class="btn btn-secondary" onclick="testLLMConnection()" id="btn-test-llm">
                        üß™ Testar Conex√£o
                    </button>
                    <div id="llm-test-result"
                        style="margin-top: 10px; font-family: monospace; font-size: 0.9em; display: none; padding: 10px; background: #222; border-radius: 4px;">
                    </div>
                </div>

    </div>
    </section>

    <!-- Offline Queue Tab -->
    <section id="tab-offline" class="tab-content">
        <h2>Fila Offline</h2>

        <div class="status-card">
            <h3>Configura√ß√µes da Fila</h3>
            <div class="form-group">
                <label>
                    <input type="checkbox" id="offline_enabled" name="offline_queue.enabled" checked>
                    Habilitar Fila Offline
                </label>
                <small>Armazena tarefas quando sem internet</small>
            </div>

            <div class="form-group">
                <label for="max_queue_size">Tamanho M√°ximo da Fila</label>
                <input type="number" id="max_queue_size" name="offline_queue.max_queue_size" min="100" max="10000"
                    value="1000">
            </div>

            <div class="form-group">
                <label for="retry_delay">Delay Base para Retry (s)</label>
                <input type="number" id="retry_delay" name="offline_queue.retry_delay_base" min="10" max="300"
                    value="30">
            </div>

            <div class="form-group">
                <label for="max_retries">M√°ximo de Retries</label>
                <input type="number" id="max_retries" name="offline_queue.max_retries" min="1" max="10" value="3">
            </div>

            <div class="form-group">
                <label>
                    <input type="checkbox" id="use_local_fallback" name="offline_queue.use_local_fallback" checked>
                    Usar LLM Local como Fallback
                </label>
            </div>
        </div>
        <div class="status-card">
            <h3>Status da Fila</h3>
            <div id="queue-stats">
                <p>Pendentes: <span id="queue-pending">-</span></p>
                <p>Processando: <span id="queue-processing">-</span></p>
                <p>Conclu√≠dos: <span id="queue-completed">-</span></p>
                <p>Conectividade: <span id="queue-online">-</span></p>
            </div>
            <button type="button" id="btn-refresh-queue" class="btn btn-secondary">üîÑ Atualizar</button>
        </div>
    </section>

    <!-- USB Receiver Tab -->
    <section id="tab-usb-receiver" class="tab-content">
        <h2>üéß Escuta Cont√≠nua & Transcri√ß√£o</h2>

        <div class="info-box">
            <p>üí° <strong>O Raspberry Pi pode escutar e transcrever √°udio automaticamente de duas
                    formas:</strong></p>
            <p>1. <strong>ReSpeaker HAT</strong> - Usa o microfone local para capturar √°udio</p>
            <p>2. <strong>USB Gadget</strong> - Recebe √°udio de um PC conectado via USB</p>
        </div>

        <!-- Modo 1: ReSpeaker (Microfone Local) -->
        <div class="status-card">
            <h3>üéôÔ∏è Modo 1: ReSpeaker HAT (Microfone Local)</h3>

            <div class="form-group">
                <label>
                    <input type="checkbox" id="usb_receiver_enabled" name="usb_receiver.enabled" checked>
                    <strong>Habilitar Escuta via ReSpeaker</strong>
                </label>
                <small>Usa o microfone do ReSpeaker HAT para capturar √°udio ambiente</small>
            </div>

            <div class="form-group">
                <label>
                    <input type="checkbox" id="usb_continuous_listen" name="usb_receiver.continuous_listen" checked>
                    <strong>Escuta Cont√≠nua Autom√°tica</strong>
                </label>
                <small>Quando habilitado, escuta e transcreve 24/7 automaticamente</small>
            </div>

            <div class="form-group">
                <label>
                    <input type="checkbox" id="usb_auto_start" name="usb_receiver.auto_start">
                    <strong>üöÄ Auto-Iniciar ao Abrir</strong>
                </label>
                <small>Inicia a escuta automaticamente quando a aplica√ß√£o √© aberta</small>
            </div>

            <div class="form-group">
                <label>
                    <input type="checkbox" id="usb_auto_process" name="usb_receiver.auto_process">
                    <strong>üîÑ Auto-Processar Arquivos</strong>
                </label>
                <small>Inicia o processamento em lote automaticamente (transcreve .wav ‚Üí .txt, remove
                    .wav)</small>
            </div>
        </div>

        <!-- Modo 2: USB Gadget -->
        <div class="status-card">
            <h3>üîå Modo 2: USB Gadget (√Åudio via USB)</h3>

            <div class="form-group">
                <label>
                    <input type="checkbox" id="usb_gadget_enabled" name="usb_receiver.usb_gadget_enabled">
                    <strong>Habilitar USB Gadget</strong>
                </label>
                <small>‚ö†Ô∏è Transforma o Pi em placa de som USB. Requer:
                    <code>sudo ./scripts/setup_usb_gadget.sh</code></small>
            </div>
        </div>

        <!-- Controles de Escuta -->
        <div class="status-card">
            <h3>üéõÔ∏è Controles de Escuta</h3>

            <div class="listener-controls">
                <button type="button" id="btn-listener-start" class="btn btn-primary">
                    ‚ñ∂Ô∏è Iniciar Escuta
                </button>
                <button type="button" id="btn-listener-pause" class="btn btn-secondary" disabled>
                    ‚è∏Ô∏è Pausar
                </button>
                <button type="button" id="btn-listener-stop" class="btn btn-danger" disabled>
                    ‚èπÔ∏è Parar
                </button>
            </div>

            <div id="listener-status" class="listener-status">
                <p>Estado: <span id="listener-state" class="status-badge">Parado</span></p>
                <p>Segmentos transcritos: <span id="listener-segments-count">0</span></p>
            </div>
        </div>
        <!-- Transcri√ß√µes em Tempo Real -->
        <div class="status-card transcriptions-panel">
            <div class="panel-header">
                <h3>üìù Transcri√ß√µes em Tempo Real</h3>
                <div class="panel-actions">
                    <button type="button" id="btn-export-json" class="btn btn-small" title="Exportar JSON">
                        üì• JSON
                    </button>
                    <button type="button" id="btn-export-txt" class="btn btn-small" title="Exportar TXT">
                        üìÑ TXT
                    </button>
                    <button type="button" id="btn-clear-segments" class="btn btn-small btn-danger" title="Limpar">
                        üóëÔ∏è
                    </button>
                </div>
            </div>

            <!-- Filtros e Busca -->
            <div class="transcription-filters">
                <div class="search-box">
                    <input type="text" id="transcription-search" placeholder="üîç Buscar nas transcri√ß√µes...">
                </div>
                <div class="filter-options">
                    <label class="filter-item">
                        <input type="checkbox" id="filter-with-summary" checked>
                        Com resumo
                    </label>
                    <select id="filter-duration">
                        <option value="">Todas dura√ß√µes</option>
                        <option value="short">Curtas (&lt; 10s)</option>
                        <option value="medium">M√©dias (10-60s)</option>
                        <option value="long">Longas (&gt; 60s)</option>
                    </select>
                </div>
            </div>

            <!-- Lista de Transcri√ß√µes -->
            <div id="live-transcriptions" class="live-transcriptions">
                <p class="empty-message">Nenhuma transcri√ß√£o ainda. Inicie a escuta para ver as transcri√ß√µes
                    em
                    tempo real.</p>
            </div>

            <!-- Controles Inferiores -->
            <div class="transcription-footer">
                <span id="transcription-count">0 transcri√ß√µes</span>
                <button type="button" id="btn-refresh-transcriptions" class="btn btn-secondary">
                    üîÑ Atualizar
                </button>
                <button type="button" id="btn-load-more" class="btn btn-secondary" disabled>
                    üìú Carregar mais
                </button>
            </div>
        </div>

        <div id="usb-receiver-config" class="config-section">
            <h3>Configura√ß√µes de Grava√ß√£o</h3>

            <div class="form-group">
                <label for="usb_save_directory">Diret√≥rio de Grava√ß√µes</label>
                <input type="text" id="usb_save_directory" name="usb_receiver.save_directory"
                    value="~/audio-recordings">
                <small>Onde os arquivos de √°udio ser√£o salvos</small>
            </div>

            <div class="form-group">
                <label for="usb_sample_rate">Taxa de Amostragem</label>
                <select id="usb_sample_rate" name="usb_receiver.sample_rate">
                    <option value="44100">44100 Hz (CD Quality)</option>
                    <option value="48000">48000 Hz (DVD Quality)</option>
                    <option value="16000">16000 Hz (Otimizado Whisper)</option>
                </select>
            </div>

            <div class="form-group">
                <label for="usb_channels">Canais</label>
                <select id="usb_channels" name="usb_receiver.channels">
                    <option value="2">Stereo (2 canais)</option>
                    <option value="1">Mono (1 canal)</option>
                </select>
            </div>

            <div class="form-group">
                <label for="usb_max_duration">Dura√ß√£o M√°xima por Arquivo (segundos)</label>
                <input type="number" id="usb_max_duration" name="usb_receiver.max_audio_duration" min="60" max="3600"
                    value="300">
                <small>Arquivos ser√£o divididos ap√≥s este tempo</small>
            </div>

            <h3>Processamento Autom√°tico</h3>

            <div class="form-group">
                <label>
                    <input type="checkbox" id="usb_auto_transcribe" name="usb_receiver.auto_transcribe" checked>
                    Transcrever automaticamente com Whisper
                </label>
            </div>

            <div class="form-group">
                <label>
                    <input type="checkbox" id="usb_auto_summarize" name="usb_receiver.auto_summarize" checked>
                    Gerar resumo autom√°tico com LLM
                </label>
            </div>

            <div class="form-group">
                <label for="usb_min_duration">Dura√ß√£o M√≠nima para Processar (segundos)</label>
                <input type="number" id="usb_min_duration" name="usb_receiver.min_audio_duration" min="1" max="60"
                    step="0.5" value="3">
                <small>√Åudios menores ser√£o ignorados</small>
            </div>

            <h3>Divis√£o por Sil√™ncio</h3>

            <div class="form-group">
                <label>
                    <input type="checkbox" id="usb_silence_split" name="usb_receiver.silence_split" checked>
                    Dividir grava√ß√£o quando detectar sil√™ncio
                </label>
            </div>

            <div class="form-group">
                <label for="usb_silence_threshold">Tempo de Sil√™ncio para Dividir (segundos)</label>
                <input type="number" id="usb_silence_threshold" name="usb_receiver.silence_threshold" min="0.5" max="10"
                    step="0.5" value="2">
            </div>

            <h3>Op√ß√µes Adicionais</h3>

            <div class="form-group">
                <label>
                    <input type="checkbox" id="usb_process_on_disconnect" name="usb_receiver.process_on_disconnect"
                        checked>
                    Processar quando USB desconectar
                </label>
            </div>

            <div class="form-group">
                <label>
                    <input type="checkbox" id="usb_keep_original" name="usb_receiver.keep_original_audio" checked>
                    Manter arquivo de √°udio original ap√≥s processar
                </label>
            </div>
        </div>

        <div class="status-card">
            <h3>Status do USB Gadget</h3>
            <div id="usb-gadget-status">
                <p>Estado: <span id="usb-gadget-state">N√£o configurado</span></p>
                <p>M√≥dulo g_audio: <span id="usb-module-status">-</span></p>
                <p>Grava√ß√µes Salvas: <span id="usb-recordings-count">0</span></p>
            </div>
            <button type="button" id="btn-check-usb-status" class="btn btn-secondary">üîÑ Verificar
                Status</button>
        </div>
    </section>

    <!-- System Tab -->
    <section id="tab-system" class="tab-content">
        <h2>Sistema</h2>

        <!-- B√°sico -->
        <div class="status-card">
            <h3>üìä Informa√ß√µes B√°sicas</h3>
            <div id="system-info" class="system-grid">
                <div class="sys-item">
                    <span class="sys-label">Hostname</span>
                    <span class="sys-value" id="sys-hostname">-</span>
                </div>
                <div class="sys-item">
                    <span class="sys-label">Plataforma</span>
                    <span class="sys-value" id="sys-platform">-</span>
                </div>
                <div class="sys-item">
                    <span class="sys-label">Hardware</span>
                    <span class="sys-value" id="sys-hardware">-</span>
                </div>
                <div class="sys-item">
                    <span class="sys-label">Serial</span>
                    <span class="sys-value mono" id="sys-serial">-</span>
                </div>
                <div class="sys-item">
                    <span class="sys-label">Uptime</span>
                    <span class="sys-value" id="sys-uptime">-</span>
                </div>
                <div class="sys-item">
                    <span class="sys-label">Load Average</span>
                    <span class="sys-value" id="sys-load">-</span>
                </div>
            </div>
        </div>

        <!-- CPU -->
        <div class="status-card">
            <h3>üî• CPU & Temperatura</h3>
            <div class="system-grid">
                <div class="sys-item">
                    <span class="sys-label">CPU Temp</span>
                    <span class="sys-value" id="sys-cpu-temp">-</span>
                </div>
                <div class="sys-item">
                    <span class="sys-label">GPU Temp</span>
                    <span class="sys-value" id="sys-gpu-temp">-</span>
                </div>
                <div class="sys-item">
                    <span class="sys-label">Frequ√™ncia Atual</span>
                    <span class="sys-value" id="sys-freq-current">-</span>
                </div>
                <div class="sys-item">
                    <span class="sys-label">Frequ√™ncia (min/max)</span>
                    <span class="sys-value" id="sys-freq-range">-</span>
                </div>
                <div class="sys-item">
                    <span class="sys-label">Governor</span>
                    <span class="sys-value" id="sys-governor">-</span>
                </div>
                <div class="sys-item">
                    <span class="sys-label">CPU Model</span>
                    <span class="sys-value" id="sys-cpu-model">-</span>
                </div>
            </div>

            <!-- Throttling -->
            <div class="throttle-status" id="throttle-container" style="margin-top: 12px;">
                <h4>‚ö° Status de Throttling</h4>
                <div id="throttle-flags" class="throttle-grid">
                    <span class="throttle-item" id="throttle-voltage">üîå Voltagem: OK</span>
                    <span class="throttle-item" id="throttle-freq">üìâ Freq Cap: OK</span>
                    <span class="throttle-item" id="throttle-thermal">üå°Ô∏è Temp Limit: OK</span>
                    <span class="throttle-item" id="throttle-active">‚è∏Ô∏è Throttled: N√ÉO</span>
                </div>
            </div>
        </div>

        <!-- Voltagens e Clocks -->
        <div class="status-card">
            <h3>‚ö° Voltagens & Clocks</h3>
            <div class="system-grid">
                <div class="sys-item">
                    <span class="sys-label">Core Voltage</span>
                    <span class="sys-value" id="sys-volt-core">-</span>
                </div>
                <div class="sys-item">
                    <span class="sys-label">SDRAM_C Voltage</span>
                    <span class="sys-value" id="sys-volt-sdram-c">-</span>
                </div>
                <div class="sys-item">
                    <span class="sys-label">SDRAM_I Voltage</span>
                    <span class="sys-value" id="sys-volt-sdram-i">-</span>
                </div>
                <div class="sys-item">
                    <span class="sys-label">SDRAM_P Voltage</span>
                    <span class="sys-value" id="sys-volt-sdram-p">-</span>
                </div>
                <div class="sys-item">
                    <span class="sys-label">ARM Clock</span>
                    <span class="sys-value" id="sys-clock-arm">-</span>
                </div>
                <div class="sys-item">
                    <span class="sys-label">Core Clock</span>
                    <span class="sys-value" id="sys-clock-core">-</span>
                </div>
                <div class="sys-item">
                    <span class="sys-label">H264 Clock</span>
                    <span class="sys-value" id="sys-clock-h264">-</span>
                </div>
                <div class="sys-item">
                    <span class="sys-label">eMMC Clock</span>
                    <span class="sys-value" id="sys-clock-emmc">-</span>
                </div>
            </div>
        </div>

        <!-- Energia -->
        <div class="status-card">
            <h3>üîã Energia Estimada</h3>
            <div class="power-display">
                <div class="power-meter">
                    <div class="power-bar" id="power-bar" style="width: 30%;"></div>
                </div>
                <div class="power-info">
                    <span class="power-value" id="sys-power">-</span>
                    <span class="power-range">500mW (idle) - 1800mW (full load)</span>
                </div>
            </div>
        </div>

        <!-- Mem√≥ria -->
        <div class="status-card">
            <h3>üíæ Mem√≥ria RAM</h3>
            <div class="memory-bar-container">
                <div class="memory-bar" id="memory-bar" style="width: 0%;"></div>
            </div>
            <div class="system-grid">
                <div class="sys-item">
                    <span class="sys-label">Total</span>
                    <span class="sys-value" id="sys-mem-total">-</span>
                </div>
                <div class="sys-item">
                    <span class="sys-label">Usado</span>
                    <span class="sys-value" id="sys-mem-used">-</span>
                </div>
                <div class="sys-item">
                    <span class="sys-label">Dispon√≠vel</span>
                    <span class="sys-value" id="sys-mem-available">-</span>
                </div>
                <div class="sys-item">
                    <span class="sys-label">% Uso</span>
                    <span class="sys-value" id="sys-mem-percent">-</span>
                </div>
                <div class="sys-item">
                    <span class="sys-label">Buffers</span>
                    <span class="sys-value" id="sys-mem-buffers">-</span>
                </div>
                <div class="sys-item">
                    <span class="sys-label">Cached</span>
                    <span class="sys-value" id="sys-mem-cached">-</span>
                </div>
                <div class="sys-item">
                    <span class="sys-label">GPU Mem</span>
                    <span class="sys-value" id="sys-gpu-mem">-</span>
                </div>
                <div class="sys-item">
                    <span class="sys-label">ARM Mem</span>
                    <span class="sys-value" id="sys-arm-mem">-</span>
                </div>
            </div>
        </div>

        <!-- Swap -->
        <div class="status-card">
            <h3>üíø Swap</h3>
            <div class="memory-bar-container">
                <div class="memory-bar swap-bar" id="swap-bar" style="width: 0%;"></div>
            </div>
            <div class="system-grid">
                <div class="sys-item">
                    <span class="sys-label">Total</span>
                    <span class="sys-value" id="sys-swap-total">-</span>
                </div>
                <div class="sys-item">
                    <span class="sys-label">Usado</span>
                    <span class="sys-value" id="sys-swap-used">-</span>
                </div>
                <div class="sys-item">
                    <span class="sys-label">Livre</span>
                    <span class="sys-value" id="sys-swap-free">-</span>
                </div>
                <div class="sys-item">
                    <span class="sys-label">% Uso</span>
                    <span class="sys-value" id="sys-swap-percent">-</span>
                </div>
            </div>
        </div>

        <!-- Disco -->
        <div class="status-card">
            <h3>üìÅ Disco</h3>
            <div class="memory-bar-container">
                <div class="memory-bar disk-bar" id="disk-bar" style="width: 0%;"></div>
            </div>
            <div class="system-grid">
                <div class="sys-item">
                    <span class="sys-label">Total</span>
                    <span class="sys-value" id="sys-disk-total">-</span>
                </div>
                <div class="sys-item">
                    <span class="sys-label">Usado</span>
                    <span class="sys-value" id="sys-disk-used">-</span>
                </div>
                <div class="sys-item">
                    <span class="sys-label">Livre</span>
                    <span class="sys-value" id="sys-disk-free">-</span>
                </div>
                <div class="sys-item">
                    <span class="sys-label">% Uso</span>
                    <span class="sys-value" id="sys-disk-percent">-</span>
                </div>
            </div>
        </div>

        <!-- Rede -->
        <div class="status-card">
            <h3>üåê Interfaces de Rede</h3>
            <div id="network-interfaces" class="network-grid">
                <p class="empty-message">Carregando...</p>
            </div>
        </div>

        <button type="button" id="btn-refresh-system" class="btn btn-primary" style="margin-top: 16px;">üîÑ Atualizar Sistema</button>

        <hr style="margin: 24px 0; border-color: #333;">

        <div class="form-group">
            <label for="log_level">N√≠vel de Log</label>
            <select id="log_level" name="system.log_level">
                <option value="DEBUG">Debug</option>
                <option value="INFO">Info</option>
                <option value="WARNING">Warning</option>
                <option value="ERROR">Error</option>
            </select>
        </div>

        <div class="form-group">
            <label for="timeout">Timeout de Processamento (s)</label>
            <input type="number" id="timeout" name="system.timeout" min="30" max="300" value="60">
        </div>

        <div class="status-card">
            <h3>Controles de Configura√ß√£o</h3>
            <div class="system-actions">
                <button type="button" id="btn-export" class="btn btn-secondary">üì§ Exportar Config</button>
                <button type="button" id="btn-import" class="btn btn-secondary">üì• Importar Config</button>
                <button type="button" id="btn-reset" class="btn btn-danger">üîÑ Resetar Padr√µes</button>
            </div>
        </div>
    </section>

    <!-- Transcription Tab -->
    <section id="tab-transcription" class="tab-content">
        <h2>üìù Transcri√ß√£o de Voz</h2>

        <!-- Controles de Grava√ß√£o -->
        <div class="transcription-controls">
            <button type="button" id="btn-record" class="btn btn-record">
                <span class="record-icon">üéôÔ∏è</span>
                <span id="record-btn-text">Iniciar Grava√ß√£o</span>
            </button>
            <div id="recording-status" class="recording-status hidden">
                <span class="pulse-dot"></span>
                <span id="recording-status-text">Gravando...</span>
            </div>
        </div>

        <!-- Resultado da Transcri√ß√£o Atual -->
        <div id="current-transcription" class="transcription-result hidden">
            <h3>√öltima Transcri√ß√£o</h3>
            <div class="transcription-text-container">
                <div class="transcription-meta">
                    <span id="trans-timestamp"></span>
                    <span id="trans-duration"></span>
                    <span id="trans-time"></span>
                </div>
                <div id="transcription-text" class="transcription-text"></div>
            </div>
            <div id="transcription-summary" class="transcription-summary hidden">
                <h4>üìã Resumo</h4>
                <p id="summary-text"></p>
            </div>
        </div>

        <!-- Upload & History -->
        <div class="status-card">
            <!-- Upload de √Åudio -->
            <div class="upload-section">
                <h3>Ou envie um arquivo de √°udio</h3>
                <div class="upload-area">
                    <input type="file" id="audio-upload" accept="audio/*,.wav,.mp3,.ogg,.m4a" hidden>
                    <button type="button" id="btn-upload" class="btn btn-secondary">
                        üì§ Enviar Arquivo de √Åudio
                    </button>
                    <span id="upload-filename"></span>
                </div>
            </div>

            <hr style="margin: 24px 0; border: 0; border-top: 1px dashed var(--border);">

            <!-- Hist√≥rico -->
            <div class="history-section">
                <div class="history-header">
                    <h3>üìú Hist√≥rico</h3>
                    <button type="button" id="btn-clear-history" class="btn btn-secondary btn-small">
                        üóëÔ∏è Limpar
                    </button>
                </div>
                <div id="transcription-history" class="transcription-history">
                    <p class="empty-history">Nenhuma transcri√ß√£o ainda.</p>
                </div>
            </div>
        </div>

        <!-- Configura√ß√£o Ativa -->
        <div class="status-card">
            <h3>‚öôÔ∏è Configura√ß√£o Ativa</h3>
            <p class="info-box">Estas s√£o as configura√ß√µes salvas que ser√£o usadas na transcri√ß√£o.</p>
            <div id="config-status">
                <p>Modo: <span id="cfg-mode" class="badge">-</span></p>
                <p>Whisper: <span id="cfg-whisper-provider" class="badge">-</span> ‚Üí Modelo: <span
                        id="cfg-whisper-model" class="badge">-</span></p>
                <p>LLM: <span id="cfg-llm-provider" class="badge">-</span> ‚Üí Modelo: <span id="cfg-llm-model"
                        class="badge">-</span></p>
                <p>Idioma: <span id="cfg-language" class="badge">-</span></p>
            </div>
            <div style="margin-top: 16px; display: flex; gap: 12px; flex-wrap: wrap;">
                <button type="button" class="btn btn-secondary btn-small" onclick="loadConfig()">üîÑ Atualizar</button>
                <a href="#" onclick="switchToTab('general'); return false;" class="btn btn-small">‚öôÔ∏è Editar
                    Configura√ß√µes</a>
            </div>
        </div>
    </section>

    <!-- Files Tab -->
    <section id="tab-files" class="tab-content">
        <h2>üìÇ Arquivos de Transcri√ß√£o</h2>

        <!-- Batch Processor Status -->
        <div class="status-card">
            <h3>üîÑ Processador em Lote</h3>
            <div id="batch-status">
                <p>Estado: <span id="batch-state" class="status-badge">Parado</span></p>
                <p>Arquivos pendentes (.wav): <span id="batch-pending">0</span></p>
                <p>Processados: <span id="batch-processed">0</span></p>
                <p>Falhas: <span id="batch-failed">0</span></p>
                <p>√öltima execu√ß√£o: <span id="batch-last-run">-</span></p>
                <p>Pr√≥xima execu√ß√£o: <span id="batch-next-run">-</span></p>
            </div>
            <div class="batch-controls">
                <button type="button" id="btn-batch-run" class="btn btn-primary">‚ñ∂Ô∏è Processar Agora</button>
                <button type="button" id="btn-batch-start" class="btn btn-secondary">üîÑ Iniciar
                    Autom√°tico</button>
                <button type="button" id="btn-batch-stop" class="btn btn-secondary" disabled>‚èπÔ∏è Parar
                    Autom√°tico</button>
            </div>
        </div>

        <!-- Info Box -->
        <div class="info-box">
            <p>üí° <strong>Como funciona:</strong></p>
            <p>1. Arquivos <code>.wav</code> s√£o gravados em <code>~/audio-recordings</code></p>
            <p>2. O processador transcreve com Whisper e salva como <code>.txt</code></p>
            <p>3. Ap√≥s sucesso, o arquivo <code>.wav</code> √© removido para economizar espa√ßo</p>
        </div>

        <!-- Search & Files -->
        <div class="status-card">
            <h3>üìë Gerenciador de Arquivos</h3>

            <div class="files-search">
                <input type="text" id="files-search-input" placeholder="üîç Buscar nas transcri√ß√µes...">
                <button type="button" id="btn-files-search" class="btn btn-secondary">Buscar</button>
                <button type="button" id="btn-files-refresh" class="btn btn-secondary">üîÑ Atualizar Lista</button>
                <button type="button" id="btn-delete-all-txt" class="btn btn-danger"
                    onclick="deleteAllTranscriptions()">
                    üóëÔ∏è Apagar Todos TXT
                </button>
            </div>

            <div class="files-list-container">
                <h3>üìÑ Transcri√ß√µes Salvas</h3>
                <div id="files-list" class="files-list">
                    <p class="empty-message">Carregando...</p>
                </div>
                <div class="files-footer">
                    <span id="files-count">0 arquivos</span>
                </div>
            </div>
        </div>

        <!-- Search Results -->
        <div id="search-results" class="search-results" style="display: none;">
            <h3>üîç Resultados da Busca</h3>
            <div id="search-results-list"></div>
            <button type="button" id="btn-clear-search" class="btn btn-secondary">Limpar Busca</button>
        </div>
    </section>

    <!-- File View Modal -->
    <div id="file-view-modal" class="modal" style="display: none;">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h3 id="modal-filename">Arquivo</h3>
                <button type="button" class="modal-close" onclick="closeFileModal()">&times;</button>
            </div>
            <div class="modal-body">
                <pre id="modal-file-content" class="file-content"></pre>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="closeFileModal()">Fechar</button>
                <button type="button" id="btn-modal-delete" class="btn btn-danger">üóëÔ∏è Deletar</button>
            </div>
        </div>
    </div>

    <!-- History Tab -->
    <section id="tab-history" class="tab-content">
        <h2>üìö Hist√≥rico de Transcri√ß√µes</h2>

        <div class="info-box">
            <p>üí° Todas as transcri√ß√µes s√£o salvas automaticamente e podem ser consultadas, buscadas e processadas com
                LLM.</p>
        </div>

        <!-- Filtros e Controles -->
        <div class="status-card">
            <h3>üîç Filtros</h3>
            <div class="history-filters">
                <div class="form-group">
                    <label for="history-date">Data:</label>
                    <input type="date" id="history-date" class="form-control">
                </div>
                <div class="form-group">
                    <label for="history-search">Buscar:</label>
                    <input type="text" id="history-search" placeholder="üîç Buscar por texto...">
                </div>
                <div class="button-group">
                    <button type="button" id="btn-history-load" class="btn btn-primary">üìÖ Carregar</button>
                    <button type="button" id="btn-history-search" class="btn btn-secondary">üîç Buscar</button>
                    <button type="button" id="btn-history-today" class="btn btn-secondary">Hoje</button>
                </div>
            </div>
        </div>

        <!-- Estat√≠sticas do Dia -->
        <div class="status-card">
            <h3>üìä Resumo</h3>
            <div class="history-stats">
                <div class="stat-item">
                    <span class="stat-value" id="history-total">0</span>
                    <span class="stat-label">Transcri√ß√µes</span>
                </div>
                <div class="stat-item">
                    <span class="stat-value" id="history-duration">0m</span>
                    <span class="stat-label">Tempo total</span>
                </div>
                <div class="stat-item">
                    <span class="stat-value" id="history-words">0</span>
                    <span class="stat-label">Palavras</span>
                </div>
            </div>
            <div class="button-group" style="margin-top: 10px;">
                <button type="button" id="btn-export-day-json" class="btn btn-small">üì• Exportar JSON</button>
                <button type="button" id="btn-export-day-txt" class="btn btn-small">üìÑ Exportar TXT</button>
                <button type="button" id="btn-consolidate" class="btn btn-small">üì¶ Consolidar</button>
            </div>
        </div>

        <!-- Timeline de Transcri√ß√µes -->
        <div class="status-card transcriptions-panel">
            <h3>üìù Timeline</h3>
            <div id="history-timeline" class="history-timeline">
                <p class="empty-message">Selecione uma data para carregar o hist√≥rico.</p>
            </div>
            <div class="transcription-footer">
                <span id="history-count">0 transcri√ß√µes</span>
                <button type="button" id="btn-history-more" class="btn btn-secondary" disabled>üìú Carregar mais</button>
            </div>
        </div>
    </section>

    <!-- LLM Processing Modal -->
    <div id="llm-modal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>ü§ñ Processar com LLM</h3>
                <button type="button" class="modal-close" onclick="closeLLMModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="llm-prompt">Prompt:</label>
                    <textarea id="llm-prompt" rows="3"
                        placeholder="Resuma o seguinte texto de forma concisa:">Resuma o seguinte texto de forma concisa:</textarea>
                </div>
                <div class="form-group">
                    <label>Texto da Transcri√ß√£o:</label>
                    <pre id="llm-input-text" class="llm-preview"></pre>
                </div>
                <div id="llm-result-container" style="display: none;">
                    <label>Resultado:</label>
                    <div id="llm-result" class="llm-result"></div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="closeLLMModal()">Cancelar</button>
                <button type="button" id="btn-process-llm" class="btn btn-primary">üöÄ Processar</button>
            </div>
        </div>
    </div>

    <!-- Logs Tab -->
    <section id="tab-logs" class="tab-content">
        <h2>üìã Logs da Aplica√ß√£o</h2>

        <!-- Stats -->
        <div class="status-card">
            <h3>üìä Estat√≠sticas</h3>
            <div class="logs-stats">
                <span class="stat-item">
                    <span class="stat-label">Total:</span>
                    <span id="logs-total" class="stat-value">0</span>
                </span>
                <span class="stat-item">
                    <span class="stat-label">Erros:</span>
                    <span id="logs-errors" class="stat-value error">0</span>
                </span>
                <span class="stat-item">
                    <span class="stat-label">Avisos:</span>
                    <span id="logs-warnings" class="stat-value warning">0</span>
                </span>
            </div>
        </div>

        <div class="status-card">
            <h3>üìë Logs do Sistema</h3>

            <!-- Controls -->
            <div class="logs-controls">
                <div class="logs-filters">
                    <select id="logs-level-filter">
                        <option value="">Todos os n√≠veis</option>
                        <option value="DEBUG">DEBUG</option>
                        <option value="INFO">INFO</option>
                        <option value="WARNING">WARNING</option>
                        <option value="ERROR">ERROR</option>
                        <option value="CRITICAL">CRITICAL</option>
                    </select>
                    <input type="number" id="logs-limit" value="100" min="10" max="500" placeholder="Limite">
                </div>
                <div class="logs-actions">
                    <button class="btn btn-small" id="btn-refresh-logs">üîÑ Atualizar</button>
                    <button class="btn btn-small" id="btn-errors-only">‚ùå S√≥ Erros</button>
                    <button class="btn btn-small btn-danger" id="btn-clear-logs">üóëÔ∏è Limpar</button>
                </div>
            </div>

            <!-- Logs List -->
            <div class="logs-container">
                <div id="logs-list" class="logs-list">
                    <p class="empty-message">Carregando logs...</p>
                </div>
            </div>
        </div>

        <!-- Auto-refresh toggle -->
        <div class="logs-footer">
            <label class="toggle-label">
                <input type="checkbox" id="logs-auto-refresh">
                Auto-atualizar (5s)
            </label>
            <span id="logs-last-update">-</span>
        </div>
    </section>

    </main>

    <!-- Footer Actions -->
    <footer class="footer">
        <button type="button" id="btn-save" class="btn btn-primary">üíæ Salvar Configura√ß√µes</button>
        <button type="button" id="btn-save-restart" class="btn btn-warning">üíæüîÑ Salvar e Reiniciar</button>
        <button type="button" id="btn-reload" class="btn btn-secondary">‚Ü©Ô∏è Recarregar</button>
        <span id="save-status"></span>
    </footer>
    </div>

    <script src="/static/js/app.js"></script>
</body>

</html>